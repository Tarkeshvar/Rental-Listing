<% layout("/layouts/boilerplate.ejs") %>

<style>
  .profile-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 1rem;
  }

  .profile-header {
    background: white;
    padding: 3rem 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid #f0f0f0;
  }

  .profile-avatar-large {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #f8f8f8;
  }

  .profile-info {
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .profile-details h2 {
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #1a1a1a;
  }

  .profile-details p {
    margin: 0.25rem 0;
    color: #666;
    font-size: 0.95rem;
  }

  .profile-details p i {
    color: #999;
    margin-right: 0.5rem;
    width: 18px;
  }

  .edit-profile-btn {
    background-color: white;
    color: #1a1a1a;
    border: 1px solid #e0e0e0;
    padding: 0.75rem 2rem;
    border-radius: 8px;
    font-weight: 500;
    margin-top: 1rem;
    transition: all 0.2s ease;
  }

  .edit-profile-btn:hover {
    background-color: #f8f8f8;
    border-color: #d0d0d0;
    transform: translateY(-1px);
  }

  .section-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid #f0f0f0;
  }

  .section-title {
    color: #1a1a1a;
    font-weight: 600;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.25rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #f5f5f5;
  }

  .section-title i {
    font-size: 1.25rem;
    color: #fe424d;
  }

  .booking-card-item {
    border: 1px solid #f0f0f0;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: all 0.2s ease;
    background: #fafafa;
  }

  .booking-card-item:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
    border-color: #e0e0e0;
  }

  .booking-status {
    display: inline-block;
    padding: 0.35rem 0.85rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .status-confirmed {
    background-color: #ecfdf5;
    color: #059669;
    border: 1px solid #d1fae5;
  }

  .status-cancelled {
    background-color: #fef2f2;
    color: #dc2626;
    border: 1px solid #fecaca;
  }

  .status-completed {
    background-color: #eff6ff;
    color: #2563eb;
    border: 1px solid #dbeafe;
  }

  .listing-card-item {
    border: 1px solid #f0f0f0;
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.2s ease;
    background: white;
  }

  .listing-card-item:hover {
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
    transform: translateY(-4px);
  }

  .listing-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .listing-body {
    padding: 1rem;
  }

  .no-data {
    text-align: center;
    padding: 3rem;
    color: #666;
  }

  .no-data i {
    font-size: 3rem;
    color: #e5e5e5;
    margin-bottom: 1rem;
  }

  .no-data h5 {
    color: #333;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }

  .no-data p {
    color: #999;
  }

  .action-btn {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    font-weight: 500;
  }

  .btn-primary-custom {
    background-color: #fe424d;
    color: white;
    border: none;
  }

  .btn-primary-custom:hover {
    background-color: #e03844;
    color: white;
    transform: translateY(-1px);
  }

  .stats-row {
    display: flex;
    gap: 2rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #f5f5f5;
  }

  .stat-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .stat-item i {
    color: #fe424d;
  }

  .stat-item span {
    color: #666;
  }

  .booking-card-item img {
    border-radius: 8px;
  }

  .booking-card-item h5 {
    font-weight: 600;
    color: #1a1a1a;
  }

  .booking-card-item p {
    color: #666;
    font-size: 0.9rem;
  }

  .booking-card-item p i {
    color: #999;
  }

  .listing-body h5 {
    font-weight: 600;
    color: #1a1a1a;
  }

  .btn-outline-secondary {
    background: white;
    border: 1px solid #e0e0e0;
    color: #666;
  }

  .btn-outline-secondary:hover {
    background: #f8f8f8;
    border-color: #d0d0d0;
    color: #666;
  }

  .btn-outline-danger {
    background: white;
    border: 1px solid #fecaca;
    color: #dc2626;
  }

  .btn-outline-danger:hover {
    background: #fef2f2;
    border-color: #fca5a5;
    color: #dc2626;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .profile-container {
      padding: 1rem;
    }

    .profile-header {
      padding: 2rem 1.5rem;
    }

    .profile-info {
      flex-direction: column;
      text-align: center;
      gap: 1.5rem;
    }

    .stats-row {
      justify-content: center;
      flex-wrap: wrap;
    }

    .section-card {
      padding: 1.5rem;
    }

    .booking-card-item {
      padding: 1rem;
    }

    .booking-card-item .text-md-end {
      text-align: left !important;
      margin-top: 1rem;
    }
  }
</style>

<div class="profile-container">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-info">
      <img
        src="<%= user.avatar?.url || 'https://via.placeholder.com/150' %>"
        alt="Profile Picture"
        class="profile-avatar-large"
      />
      <div class="profile-details flex-grow-1">
        <h2><%= user.username %></h2>
        <p><i class="fa-solid fa-envelope"></i> <%= user.email %></p>
        <% if(user.phone) { %>
        <p><i class="fa-solid fa-phone"></i> <%= user.phone %></p>
        <% } %>
        <p>
          <i class="fa-solid fa-calendar"></i> Member since <%= new
          Date(user.createdAt).toLocaleDateString('en-US', { month: 'long',
          year: 'numeric' }) %>
        </p>

        <div class="stats-row">
          <div class="stat-item">
            <i class="fa-solid fa-home"></i>
            <span><%= listings.length %> Listings</span>
          </div>
          <div class="stat-item">
            <i class="fa-solid fa-calendar-check"></i>
            <span><%= bookings.length %> Bookings</span>
          </div>
        </div>

        <a href="/profile/edit" class="btn edit-profile-btn">
          <i class="fa-solid fa-pen-to-square"></i> Edit Profile
        </a>
      </div>
    </div>
  </div>

  <!-- My Bookings Section -->
  <div class="section-card">
    <h3 class="section-title">
      <i class="fa-solid fa-calendar-check"></i>
      My Bookings
    </h3>

    <% if(bookings.length > 0) { %> <% for(let booking of bookings) { %>
    <div class="booking-card-item">
      <div class="row align-items-center">
        <div class="col-md-3 mb-3 mb-md-0">
          <img
            src="<%= booking.listing.image.url %>"
            alt="<%= booking.listing.title %>"
            class="img-fluid"
            style="
              height: 120px;
              width: 100%;
              object-fit: cover;
              border-radius: 8px;
            "
          />
        </div>
        <div class="col-md-6 mb-3 mb-md-0">
          <h5 class="mb-2"><%= booking.listing.title %></h5>
          <p class="mb-1">
            <i class="fa-solid fa-location-dot"></i>
            <%= booking.listing.location %>, <%= booking.listing.country %>
          </p>
          <p class="mb-1">
            <i class="fa-solid fa-calendar"></i>
            <%= new Date(booking.checkIn).toLocaleDateString() %> - <%= new
            Date(booking.checkOut).toLocaleDateString() %>
          </p>
          <p class="mb-2">
            <i class="fa-solid fa-users"></i> <%= booking.guests %> Guest(s)
          </p>
          <span class="booking-status status-<%= booking.bookingStatus %>">
            <%= booking.bookingStatus.toUpperCase() %>
          </span>
        </div>
        <div class="col-md-3 text-md-end">
          <h4 class="mb-3" style="color: #fe424d; font-weight: 600">
            ₹<%= booking.totalPrice.toLocaleString('en-IN') %>
          </h4>

          <a
            href="/bookings/<%= booking._id %>/receipt"
            class="btn btn-outline-secondary action-btn d-block mb-2"
          >
            <i class="fa-solid fa-download"></i> Download Receipt
          </a>
          <% if(booking.bookingStatus === 'confirmed') { %>
          <form
            action="/bookings/<%= booking._id %>/cancel"
            method="POST"
            class="d-inline w-100"
          >
            <button
              type="submit"
              class="btn btn-outline-danger action-btn w-100"
              onclick="return confirm('Are you sure you want to cancel this booking?')"
            >
              <i class="fa-solid fa-times"></i> Cancel
            </button>
          </form>
          <% } %>
        </div>
      </div>
    </div>
    <% } %> <% } else { %>
    <div class="no-data">
      <i class="fa-solid fa-calendar-xmark"></i>
      <h5>No bookings yet</h5>
      <p>Start exploring and book your next adventure!</p>
      <a href="/listings" class="btn btn-primary-custom">
        <i class="fa-solid fa-magnifying-glass"></i> Explore Listings
      </a>
    </div>
    <% } %>
  </div>

  <!-- My Listings Section -->
  <div class="section-card">
    <h3 class="section-title">
      <i class="fa-solid fa-home"></i>
      My Listings
    </h3>

    <% if(listings.length > 0) { %>
    <div class="row">
      <% for(let listing of listings) { %>
      <div class="col-md-4 col-sm-6 mb-4">
        <div class="listing-card-item">
          <img
            src="<%= listing.image.url %>"
            alt="<%= listing.title %>"
            class="listing-image"
          />
          <div class="listing-body">
            <h5 class="mb-2"><%= listing.title %></h5>
            <p class="text-muted mb-2">
              <i class="fa-solid fa-location-dot"></i>
              <%= listing.location %>
            </p>
            <p class="mb-2" style="color: #fe424d; font-weight: 600">
              ₹<%= listing.price.toLocaleString('en-IN') %> / night
            </p>
            <div class="d-flex gap-2">
              <a
                href="/listings/<%= listing._id %>"
                class="btn btn-sm btn-outline-secondary flex-grow-1"
              >
                <i class="fa-solid fa-eye"></i> View
              </a>
              <a
                href="/listings/<%= listing._id %>/edit"
                class="btn btn-sm btn-primary-custom flex-grow-1"
              >
                <i class="fa-solid fa-pen"></i> Edit
              </a>
            </div>
          </div>
        </div>
      </div>
      <% } %>
    </div>
    <% } else { %>
    <div class="no-data">
      <i class="fa-solid fa-house-circle-xmark"></i>
      <h5>No listings yet</h5>
      <p>Share your space with travelers from around the world!</p>
      <a href="/listings/new" class="btn btn-primary-custom">
        <i class="fa-solid fa-plus"></i> Create New Listing
      </a>
    </div>
    <% } %>
  </div>
</div>
